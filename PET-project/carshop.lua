misccars = {
{"Bus", 0xD577C962},
{"Trashmaster", 0x72435A19},
{"Romero", 0x2560B2FC},
{"Stanier Taxi", 0xC703DB5F},
{"Merit Taxi", 0x480DAF95},
{"Cabby", 0x705A3E41},
{"Police Stanier", 0x79FBB0C5},
{"Police Merit", 0x9F05F101},
{"Police Patriot", 0xEB221FC2},
{"Police Stockade", 0x8EB78F5A},
{"Enforcer", 0x71EF6313},
{"Ambulance", 0x45D56ADA},
{"Fire truck", 0x73920F8E},
{"Airtug", 0x5D0AAC8F},
{"Ripley", 0xCD935EF9},
{"Forklift", 0x58E49664}
}

carinfo = {
{"Admiral", 25000, 1264341792},
{"Banshee", 160000, 3253274834},
{"Blista", 15000, 3950024287},
{"Bobcat", 25000, 1075851868},
{"Buccaneer", 18000, 3612755468},
{"Burrito", 22000, 2948279460},
{"Cavalcade", 70000, 2006918058},
{"Chavos", 20000, 4227685218},
{"Cognoscenti", 90000, 2264796000},
{"Comet", 500000, 1063483177},
{"Coquette", 350000, 108773431},
{"Dilettante", 20000, 3164157193},
{"Dukes", 22000, 723973206},
{"Contender", 25000, 2323011842},
{"Emperor", 25000, 3609690755},
{"Esperanto", 18000, 4018066781},
{"Faction", 18000, 2175389151},
{"Feltzer", 30000, 3197138417},
{"Feroci", 18000, 974744810},
{"Fortune", 16000, 627033353},
{"Futo", 14000, 2016857647},
{"Cavalcade_FXT", 55000, 675415136},
{"Habanero", 22000, 884422927},
{"Hakumai", 15000, 3953074643},
{"Huntley_Sport", 80000, 486987393},
{"Infernus", 450000, 418536135},
{"Ingot", 10000, 3005245074},
{"Intruder", 25000, 886934177},
{"Landstalker", 30000, 1269098716},
{"Lokus", 13000, 4257937240},
{"Manana", 12000, 2170765704},
{"Marbella", 15000, 1304597482},
{"Merit", 18000, 3034085758},
{"Minivan", 20000, 3984502180},
{"Moonbeam", 22000, 525509695},
{"Oracle", 25000, 1348744438},
{"Patriot", 50000, 3486509883},
{"Perennial", 20000, 2217223699},
{"Peyote", 25000, 1830407356},
{"Pinnacle", 20000, 131140572},
{"PMP_600", 32000, 1376298265},
{"Pony", 18000, 4175309224},
{"Premier", 18000, 2411098011},
{"Presidente", 25000, 2332896166},
{"Primo", 18000, 3144368207},
{"Rancher", 25000, 1390084576},
{"Rebla", 35000, 83136452},
{"Ruiner", 19000, 4067225593},
{"Sabre", 20000, 3845944409},
{"Sabre_GT", 50000, 2609945748},
{"Schafter", 25000, 3972623423},
{"Sentinel", 25000, 1349725314},
{"Solair", 20000, 1344573448},
{"Stallion", 22000, 1923400478},
{"Stratum", 18000, 1723137093},
{"Sultan", 35000, 970598228},
{"Sultan_RS", 250000, 3999278268},
{"Super_GT", 200000, 1821991593},
{"Turismo", 200000, 2398307655},
{"Uranus", 15000, 1534326199},
{"Vigero", 18000, 3469130167},
{"Vincent", 20000, 3711685889},
{"Virgo", 18000, 3796912450},
{"Voodoo", 20000, 2006667053},
{"Washington", 22000, 1777363799},
{"Willard", 18000, 1937616578},
{"Freeway", 20000, 2464508460},
{"Faggio", 7000, 2452219115},
{"Hellfury", 25000, 584879743},
{"NRG_900", 25000, 1203311498},
{"PCJ_600", 20000, 3385765638},
{"Sanchez", 12000, 788045382},
{"Zombie", 25000, 3724934023},
{"APC", 1000000, 562680400},
{"Bati", 15000, 4180675781},
{"Bati_Custom", 20000, 3403504941},
{"Buffalo", 65000, 3990165190},
{"Bullet_GT", 800000, 2598821281},
{"Double_T", 12000, 2623969160},
{"Double_T_Custom", 15000, 2535109211},
{"Hakuchou", 82000, 1265391242},
{"Hakuchou_Custom", 85000, 4039289119},
{"Hexer", 15000, 301427732},
{"Schafter_II", 30000, 3039514899},
{"Serrano", 60000, 1337041428},
{"Slamvan", 20000, 729783779},
{"Super_Drop_Diamond", 500000, 1638119866},
{"Tampa", 75000, 972671128},
{"Rhapsody", 20000, 841808271},
{"Lycan", 18000, 802082487},
{"Nightblade", 22000, 2688780135},
{"Revenant", 20000, 3935799761},
{"Diabolus", 25000, 3886915065},
{"Wolfsbane", 25000, 3676349299},
{"Daemon", 22000, 2006142190},
{"Angel", 20000, 3723957976},
{"Wayfarer", 20000, 4217198264},
{"Regina", 10000, 4280472072},
{"Stretch", 25000, 2333339779},
{"DF8-90", 18000, 162883121},
{"Akuma", 50000, 0x63ABADE7},
{"F620", 200000, 0xDCBCBE48},
{"Faggio_Classic", 5000, 0x0350D1AB},
{"Stretch_E", 40000, 0xF92AEC4D},
{"Schafter_II_Custom", 50000, 0xA774B5A6},
{"Serrano_Custom", 80000, 0x3EA948D6},
{"Vader", 25000, 0xF79A00F7},
{"Brickade", 30000, 0xEDC6F847}
}
cars = {}
for i=1,#carinfo,1 do
	cars[i] = 0
end

RegisterNetEvent('updCars')
AddEventHandler('updCars', function(data)
	for i=1,#data,1 do
		cars[i] = tonumber(data[i])
	end
end)

SaveCars = function()
	local data = {}
	for i=1,#cars,1 do
		data[i] = cars[i]
	end
	TriggerServerEvent('saveCars', data)
end

mileage = {}
for i=1,#carinfo,1 do
	mileage[i] = 0.0
end
RegisterNetEvent('updMileage')
AddEventHandler('updMileage', function(data)
	for i=1,#mileage,1 do
		mileage[i] = tonumber(data[i]) or 0.0
	end
end)
SaveMileage = function()
	TriggerServerEvent('saveMileage', mileage)
end
CreateThread(function()
	while true do
		Wait(1000)
		if(IsCharInCar(GetPlayerChar(GetPlayerId()), car)) then
			for i=1,#carinfo,1 do
				if(IsCarModel(car, carinfo[i][3])) then
					local speed = GetCarSpeed(car)
					if(speed > 0) then
						mileage[i] = mileage[i] + math.floor(speed)/1000
						SaveMileage()
					end
					break
				end
			end
		end
	end
end)

local carshopcoords = {
{{-1496.90393, 1118.74939, 23.21376, 269.805053710938}, {-1494.98145, 1131.26147, 23.2127, 267.070190429688}},
{{-1088.06372, 1473.52173, 24.79185, 90.0429992675781}, {-1080.53271, 1468.86926, 24.79183, 233.046844482422}},
{{80.17219, 801.10474, 15.16314, 270.032409667969}, {72.36373, 799.98822, 15.16315, 90.1245498657227}}
}
local carshopblip = {}

CreateThread(function()
	while true do
		Wait(0)
		for i=1,#carshopcoords,1 do
			if(not DoesBlipExist(carshopblip[i])) then
				carshopblip[i] = AddBlipForCoord(carshopcoords[i][1][1], carshopcoords[i][1][2], carshopcoords[i][1][3], _i)
				ChangeBlipSprite(carshopblip[i], 91)
				ChangeBlipScale(carshopblip[i], 0.7)
				ChangeBlipColour(carshopblip[i], 19)
				ChangeBlipNameFromAscii(carshopblip[i], "Car shop")
				SetBlipAsShortRange(carshopblip[i], true)
			end
			DrawTextAtCoord(carshopcoords[i][1][1], carshopcoords[i][1][2], carshopcoords[i][1][3], "Car_shop", 20)
			DrawCheckpointWithDist(carshopcoords[i][1][1], carshopcoords[i][1][2], carshopcoords[i][1][3]-1, 1.1, 255, 255, 0, 100)
			if(IsPlayerNearCoords(carshopcoords[i][1][1], carshopcoords[i][1][2], carshopcoords[i][1][3], 1)) then
				PrintStringWithLiteralStringNow("STRING", "Press ~y~E ~w~to ~y~open car list", 1000, 1)
				if(IsGameKeyboardKeyJustPressed(18)) then
					::main::
					local tempitems = {}
					for i=1,#carinfo,1 do
						tempitems[#tempitems+1] = "" .. carinfo[i][1] .. " ~g~(" .. carinfo[i][2] .. "$)"
					end
					DrawWindow("Select_car_to_preview", tempitems)
					while menuactive do
						Wait(0)
					end
					if(menuresult > 0) then
						DeleteCar(carinshowroom)
						carinshowroom = SpawnCar(carinfo[menuresult][3], carshopcoords[i][2][1], carshopcoords[i][2][2], carshopcoords[i][2][3], carshopcoords[i][2][4])
						FreezeCarPosition(carinshowroom, true)
						WarpCharIntoCar(GetPlayerChar(GetPlayerId()), carinshowroom)
						AttachCarToCarPhysically(carinshowroom, carinshowroom, true, 1, 0, 0, 0, 0, 0, 0, 0, 0)
						SetPlayerControl(GetPlayerId(), false)
						SetCharVisible(GetPlayerChar(GetPlayerId()), false)
						local tempcar = menuresult
						::carmenu::
						DrawWindow("" .. carinfo[tempcar][1], {"Purchase ~g~(" .. carinfo[tempcar][2] .. "$)"})
						while menuactive do
							Wait(0)
							SetPlayerControl(GetPlayerId(), false)
							if(IsMouseButtonPressed(1)) then
								SetCamActive(GetGameCam(), true)
							else
								SetCamActive(GetGameCam(), false)
							end
						end
						if(menuresult > 0) then
							if(menuresult == 1) then
								local hashouse = 0
								for j=1,#houses,1 do
									if(houses[j] == 1) then
										hashouse = 1
									end
								end
								if(hashouse == 1) then
									local tempamount = 0
									for j=1,#cars,1 do
										if(cars[j] == 1) then
											tempamount = tempamount + 1
										end
									end
									local tempgarage = 0
									for j=1,#houses,1 do
										if(houses[j] == 1) then
											tempgarage = tempgarage + houseinfo[j][4]
										end
									end
									if(tempamount < tempgarage) then
										if(cars[tempcar] == 0) then
											if(money >= carinfo[tempcar][2]) then
												money = money - carinfo[tempcar][2]
												SaveStats()
												cars[tempcar] = 1
												SaveCars()
												TriggerEvent('chatMessage', '[Car shop]', {0, 255, 0}, 'You have bought this car! You can spawn it at your apartment.')
											else
												TriggerEvent('chatMessage', '[Car shop]', {255, 0, 0}, 'You do not have enough money!')
											end
										else
											TriggerEvent('chatMessage', '[Car shop]', {255, 255, 0}, 'You already have this car.')
										end
									else
										TriggerEvent('chatMessage', '[Car shop]', {255, 0, 0}, 'Out of garage places!')
									end
								else
									TriggerEvent('chatMessage', '[Car shop]', {255, 0, 0}, 'You must have a purchased apartment to buy cars!')
								end
							end
							goto carmenu
						else
							goto main
						end
					else
						DetachCar(carinshowroom)
						DeleteCar(carinshowroom)
						SetCharCoordinates(GetPlayerChar(GetPlayerId()), carshopcoords[i][1][1], carshopcoords[i][1][2], carshopcoords[i][1][3]-1)
						SetPlayerControl(GetPlayerId(), true)
						SetCharVisible(GetPlayerChar(GetPlayerId()), true)
					end
				end
			end
		end
	end
end)

local carblip = nil
CreateThread(function()
	while true do
		Wait(0)
		if(not IsCarDead(car)) then
			if(not IsCharInCar(GetPlayerChar(-1), car)) then
				if(not DoesBlipExist(carblip)) then
					carblip = AddBlipForCar(car)
					ChangeBlipSprite(carblip, 79)
					ChangeBlipColour(carblip, 3)
					ChangeBlipScale(carblip, 0.7)
					ChangeBlipNameFromAscii(carblip, "Your car")
					SetBlipAsShortRange(carblip, true)
				end
			else
				RemoveBlip(carblip)
			end
		else
			RemoveBlip(carblip)
		end
	end
end)